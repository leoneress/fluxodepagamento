<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fluxo de Pagamento</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.8.2/jspdf.plugin.autotable.min.js"></script>
    
<style>
    body { 
        background-color: #1a1a1a; 
        color: #f0f0f0; 
        font-family: 'Poppins', sans-serif; 
        margin: 0; 
        padding: 15px;
        font-size: 15px;
    }
    
    #simulador-pagamento { 
        max-width: 550px;
        margin: auto; 
        background-color: #2c2c2c; 
        border-radius: 12px; 
        padding: 25px;
        border: 1px solid #444; 
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2); 
    }
    
    .titulo-principal { 
        text-align: center; 
        background: transparent; 
        color: #ffffff; 
        padding: 0; 
        margin-bottom: 25px;
        font-weight: 600; 
        letter-spacing: 1px; 
        border-bottom: 1px solid #3098D9; 
        padding-bottom: 10px;
    }
    
    h3 { 
         font-weight: 600;
         color: #3098D9; 
         margin-top: 30px;
         border-bottom: 1px solid #444; 
         padding-bottom: 8px;
     }

    fieldset {
        border: 1px solid #444;
        border-radius: 8px;
        padding: 20px;
        margin-top: 20px;
        margin-bottom: 20px;
    }
    legend {
        font-weight: 600;
        color: #3098D9;
        padding: 0 10px;
    }
    
    .tabela-entradas { 
        width: 100%; 
        border-spacing: 0 12px;
    }
    
    .tabela-entradas td { padding: 2px 6px; vertical-align: middle; }
    .tabela-entradas tr { display: flex; align-items: center; justify-content: space-between; }
    .tabela-entradas tr td:first-child { width: 35%; font-weight: 600; color: #ccc; font-size: 13px; }
    .tabela-entradas tr td:last-child { width: 65%; }
    
    input[type="text"], input[type="number"], input[type="date"] { 
        background-color: #3a3a3a; 
        color: #f0f0f0; 
        border: 1px solid #555; 
        border-radius: 6px;
        padding: 8px;
        font-size: 14px;
        width: 100%; 
        box-sizing: border-box; 
        transition: border-color 0.3s, box-shadow 0.3s; 
    }
    
    input[type="text"]:focus, input[type="number"]:focus, input[type="date"]:focus { outline: none; border-color: #00aaff; box-shadow: 0 0 0 3px rgba(0, 170, 255, 0.2); }
    
    .grupo-botoes { 
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 12px;
        margin-top: 20px; 
    }

    #btn-salvar-negocio { font: color= #1D3557;

    }
    
    

    #btn-calcular {
        grid-column: 1 / -1; /* Bot√£o de calcular ocupa a primeira linha inteira */
    }
    
    .botao-principal { 
        padding: 10px;
        font-size: 15px;
        font-weight: 600; 
        border-radius: 8px; 
        border: none; 
        color: white; 
        cursor: pointer; 
        transition: transform 0.2s, background-color 0.2s; 
    }
    
    .botao-principal:hover:not(:disabled) { transform: translateY(-2px); }
    .botao-principal:disabled { background-color: #666; color: #aaa; cursor: not-allowed; }
    .btn-calcular { background-color: #3098D9; }
    .btn-pdf { background-color: #1E3859; }
    .btn-copiar { background-color: #1E3859; }
    .btn-salvar { background-color: #82D9D0; grid-column: 1 / -1; font-size: 16px; padding: 12px;  color: #1D3557;}
    
    .tabela-resultado { border-collapse: collapse; text-align: center; width: 100%; margin-top: 20px; }
    .tabela-resultado th, .tabela-resultado td { border: 1px solid #444; padding: 10px; }
    .tabela-resultado thead { background-color: #333; color: #3098D9; font-weight: 600; text-transform: uppercase; }
    .tabela-resultado tbody tr:nth-child(even) { background-color: #2c2c2c; }
    .tabela-resultado tfoot tr { background: #3098D9; color: #1a1a1a; font-weight: bold; }
    
    #resumo-empreendimento { background: #3a3a3a; border-left: 4px solid #3098D9; padding: 15px; border-radius: 8px; }
    #totalPerc.invalido { color: red; font-weight: bold; }
    #totalPerc.valido { color: #5cb85c; font-weight: bold; }

    .notificacao-popup {
        position: fixed;
        bottom: -100px;
        left: 50%;
        transform: translateX(-50%);
        padding: 15px 25px;
        border-radius: 8px;
        color: white;
        box-shadow: 0 4px 15px rgba(0,0,0,0.3);
        z-index: 1000;
        transition: bottom 0.5s ease-in-out;
    }
    .notificacao-popup.show {
        bottom: 30px;
    }
    .notificacao-popup.success { background-color: #5cb85c; }
    .notificacao-popup.error { background-color: #d9534f; }
    
    @media (max-width: 768px) {
        body { padding: 10px; }
        #simulador-pagamento { padding: 15px; }
        .tabela-entradas tr { flex-direction: column; align-items: flex-start; margin-bottom: 10px; gap: 5px; }
        .tabela-entradas tr td:first-child, .tabela-entradas tr td:last-child { width: 100%; padding: 0; }
        .grupo-botoes { grid-template-columns: 1fr; }
        .tabela-wrapper { overflow-x: auto; }
        .tabela-resultado th, .tabela-resultado td { font-size: 14px; padding: 8px; }
    }
</style>

</head>
<body>
 
<div id="simulador-pagamento">
    <h2 class="titulo-principal">SIMULA√á√ÉO DE FLUXO DE PAGAMENTO</h2>
    <div class="bloco-entradas">
        <fieldset>
            <legend>Dados da Proposta</legend>
            <table class="tabela-entradas">
                <tr><td>Nome Empreendimento:</td><td><input type="text" id="nomeEmpreendimento" placeholder="Obrigat√≥rio"></td></tr>
                <tr><td>Tipo Unidade:</td><td><input type="text" id="tipoUnidade" placeholder="Obrigat√≥rio"></td></tr>
                <tr><td>√Årea Privativa (m¬≤):</td><td><input type="text" id="areaPrivativa" placeholder="Obrigat√≥rio"></td></tr>
                <tr><td>Nome do Cliente:</td><td><input type="text" id="nomeCliente" placeholder="Opcional"></td></tr>
                <tr><td>Data da Proposta:</td><td><input type="date" id="dataProposta"></td></tr>
                <tr><td>Executivo(a):</td><td><input type="text" id="nomeExecutivo" placeholder="Opcional"></td></tr>
                <tr><td><strong>ID do Neg√≥cio (Bitrix24):</strong></td><td><input type="number" id="bitrixDealId" placeholder="ID num√©rico do neg√≥cio"></td></tr>
            </table>
        </fieldset>

        <fieldset>
            <legend>Valores e Parcelas</legend>
            <label for="valorTotal">Valor do Im√≥vel (R$):</label>
            <input type="number" id="valorTotal" placeholder="Digite o valor total" style="margin-top: 10px; margin-bottom: 10px; width: 100%;">
            <table class="tabela-entradas">
                <tr><th>Etapa</th><th>Parcelas</th><th></th><th></th><th>%</th></tr>
                <tr class="linha-etapa" data-etapa="Ato"><td>Ato</td><td><input type="number" class="qnt-input" placeholder="Qtde"></td><td><input type="number" class="perc-input" placeholder="%"></td></tr>
                <tr class="linha-etapa" data-etapa="Sinal"><td>Sinal</td><td><input type="number" class="qnt-input" placeholder="Qtde"></td><td><input type="number" class="perc-input" placeholder="%"></td></tr>
                <tr class="linha-etapa" data-etapa="Mensais"><td>Mensais</td><td><input type="number" class="qnt-input" placeholder="Qtde"></td><td><input type="number" class="perc-input" placeholder="%"></td></tr>
                <tr class="linha-etapa" data-etapa="Anual"><td>Anual</td><td><input type="number" class="qnt-input" placeholder="Qtde"></td><td><input type="number" class="perc-input" placeholder="%"></td></tr>
                <tr class="linha-etapa" data-etapa="Unica"><td>√önica</td><td><input type="number" class="qnt-input" placeholder="Qtde"></td><td><input type="number" class="perc-input" placeholder="%"></td></tr>
                <tr class="linha-etapa" data-etapa="Financiamento"><td>Financiamento</td><td><input type="number" class="qnt-input" placeholder="Qtde"></td><td><input type="number" class="perc-input" placeholder="%"></td></tr>
                <tr><td><strong>Total %</strong></td><td></td><td><span id="totalPerc">0.00%</span></td></tr>
            </table>
        </fieldset>
        
        <div class="grupo-botoes">
            <button id="btn-calcular" class="botao-principal btn-calcular">Calcular</button>
            <button id="btn-copiar-texto" class="botao-principal btn-copiar">Copiar Texto</button>
            <button id="btn-gerar-pdf" class="botao-principal btn-pdf">Download PDF</button>
            <button id="btn-salvar-negocio" class="botao-principal btn-salvar">Salvar PDF no Neg√≥cio</button>
        </div>
    </div>
    <h3 style="margin-top: 20px;">Resultado:</h3>
    <div id="resumo-empreendimento" style="display: none;"></div>
    <div class="tabela-wrapper">
        <table class="tabela-resultado">
            <thead>
                <tr><th>PARCELAS</th><th>QTDE</th><th>VALOR PARCELA</th><th>SUBTOTAL</th></tr>
            </thead>
            <tbody id="resultado"></tbody>
            <tfoot>
                <tr><td colspan="3">Total</td><td id="totalValor">R$ 0,00</td></tr>
            </tfoot>
        </table>
    </div>
</div>

<div id="notificacao" class="notificacao-popup"></div>

<script>
    function mostrarNotificacao(mensagem, tipo = 'success') {
        const popup = document.getElementById('notificacao');
        popup.textContent = mensagem;
        popup.className = `notificacao-popup ${tipo} show`;
        setTimeout(() => {
            popup.className = 'notificacao-popup';
        }, 3000);
    }

    function obterDadosCalculados() {
        const valorTotal = parseFloat(document.getElementById('valorTotal').value) || 0;
        const areaPri = document.getElementById('areaPrivativa').value;
        const areaNum = parseFloat(areaPri) || 0;
        const dados = {
            nomeEmpreendimento: document.getElementById('nomeEmpreendimento').value,
            tipoUnidade: document.getElementById('tipoUnidade').value,
            areaPrivativa: areaPri,
            nomeCliente: document.getElementById('nomeCliente').value,
            dataProposta: document.getElementById('dataProposta').value,
            nomeExecutivo: document.getElementById('nomeExecutivo').value,
            valorTotal: valorTotal,
            precoM2Texto: 'N√£o aplic√°vel',
            totalGeral: 0,
            parcelas: []
        };
        if (valorTotal > 0 && areaNum > 0) {
            const precoM2 = valorTotal / areaNum;
            dados.precoM2Texto = precoM2.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });
        }
        document.querySelectorAll('.linha-etapa').forEach(linha => {
            const perc = parseFloat(linha.querySelector('.perc-input').value) || 0;
            if (perc > 0) {
                const qtde = parseInt(linha.querySelector('.qnt-input').value) || 1;
                const subtotal = (perc / 100) * valorTotal;
                dados.totalGeral += subtotal;
                dados.parcelas.push({
                    nome: linha.dataset.etapa,
                    qtde: qtde,
                    valorParcela: subtotal / qtde,
                    subtotal: subtotal
                });
            }
        });
        return dados;
    }

    function renderizarResultados() {
        const dados = obterDadosCalculados();
        const resumoContainer = document.getElementById('resumo-empreendimento');
        const resultadoBody = document.getElementById('resultado');
        const totalValorFooter = document.getElementById('totalValor');
        if (dados.nomeEmpreendimento || dados.tipoUnidade || dados.areaPrivativa) {
            resumoContainer.innerHTML = `<p><strong>Cliente:</strong> ${dados.nomeCliente || 'N√£o informado'}</p><p><strong>Empreendimento:</strong> ${dados.nomeEmpreendimento || 'N√£o informado'}</p><p><strong>Unidade:</strong> ${dados.tipoUnidade || 'N√£o informado'}</p><p><strong>√Årea Privativa:</strong> ${dados.areaPrivativa ? dados.areaPrivativa + ' m¬≤' : 'N√£o informado'}</p><p><strong>Pre√ßo por m¬≤:</strong> ${dados.precoM2Texto}</p>`;
            resumoContainer.style.display = 'block';
        } else {
            resumoContainer.style.display = 'none';
        }
        let corpoTabelaHTML = "";
        dados.parcelas.forEach(p => {
            corpoTabelaHTML += `<tr><td>${p.nome}</td><td>${p.qtde}</td><td>${p.valorParcela.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' })}</td><td>${p.subtotal.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' })}</td></tr>`;
        });
        resultadoBody.innerHTML = corpoTabelaHTML;
        totalValorFooter.innerHTML = `<strong>${dados.totalGeral.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' })}</strong>`;
    }

    function atualizarTotalPerc() {
        const spanTotalPerc = document.getElementById('totalPerc');
        const btnCalcular = document.getElementById('btn-calcular');
        let totalPerc = 0;
        document.querySelectorAll('.perc-input').forEach(input => {
            totalPerc += parseFloat(input.value) || 0;
        });
        if (spanTotalPerc) {
            spanTotalPerc.textContent = totalPerc.toFixed(2) + "%";
            const isTotal100 = totalPerc.toFixed(2) === '100.00';
            spanTotalPerc.className = isTotal100 ? 'valido' : 'invalido';
        }
        if (btnCalcular) {
            btnCalcular.disabled = !isTotal100;
        }
    }

    async function criarDocumentoPdf(dados) {
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF();
        try {
            const logoUrl = 'https://i.imgur.com/BcWPfEr.png';
            const respostaLogo = await fetch(logoUrl).then(res => res.blob());
            const logoBase64 = await new Promise(resolve => {
                const reader = new FileReader();
                reader.onloadend = () => resolve(reader.result);
                reader.readAsDataURL(respostaLogo);
            });
            doc.addImage(logoBase64, 'PNG', 110, 25, 75, 15);
        } catch (error) {
            console.error("Erro ao carregar o logo.", error);
        }
        const dataFormatada = dados.dataProposta ? dados.dataProposta.split('-').reverse().join('/') : new Date().toLocaleDateString('pt-BR');
        doc.setFontSize(18); doc.text("Proposta de Pagamento", 14, 22); doc.setFontSize(11);
        doc.text(`Empreendimento: ${dados.nomeEmpreendimento || 'N√£o informado'}`, 14, 32);
        doc.text(`Unidade: ${dados.tipoUnidade || 'N√£o informado'}`, 14, 38);
        doc.text(`√Årea Privativa: ${dados.areaPrivativa ? dados.areaPrivativa + ' m¬≤' : 'N√£o informado'}`, 14, 44);
        doc.text(`Pre√ßo por m¬≤: ${dados.precoM2Texto}`, 14, 50);
        doc.text(`Cliente: ${dados.nomeCliente || 'N√£o informado'}`, 14, 58);
        doc.text(`Data: ${dataFormatada}`, 14, 64);
        const tabelaHead = [["PARCELAS", "QTDE", "VALOR PARCELA", "SUBTOTAL"]];
        const tabelaBody = dados.parcelas.map(p => [ p.nome, p.qtde, p.valorParcela.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' }), p.subtotal.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' }) ]);
        doc.autoTable({ head: tabelaHead, body: tabelaBody, startY: 72, theme: 'grid', headStyles: { fillColor: [4, 40, 70] } });
        const finalY = doc.lastAutoTable.finalY; const totalGeralTexto = dados.totalGeral.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });
        doc.setFontSize(12); doc.setFont("helvetica", "bold"); doc.text(`Valor no Fluxo: ${totalGeralTexto}`, 14, finalY + 10);
        doc.setFont("helvetica", "normal"); doc.setFontSize(10); doc.text(`Executivo(a): ${dados.nomeExecutivo || 'N√£o informado'}`, 14, finalY + 16);
        return doc;
    }

    function validarCampos(dados, checarIdNegocio = false) {
        if (!dados.nomeEmpreendimento || !dados.tipoUnidade || !dados.areaPrivativa || !dados.valorTotal) {
            mostrarNotificacao("Preencha os campos obrigat√≥rios: Empreendimento, Unidade, √Årea e Valor.", 'error');
            return false;
        }
        if (document.getElementById('totalPerc').textContent !== '100.00%') {
            mostrarNotificacao("A soma das porcentagens das parcelas deve ser 100%.", 'error');
            return false;
        }
        if (checarIdNegocio && !document.getElementById('bitrixDealId').value) {
            mostrarNotificacao("Por favor, insira o ID do Neg√≥cio do Bitrix24.", 'error');
            return false;
        }
        return true;
    }

    async function apenasFazerDownload() {
        const dados = obterDadosCalculados();
        if (!validarCampos(dados)) return;

        const btnPdf = document.getElementById('btn-gerar-pdf');
        btnPdf.textContent = 'A Gerar...';
        btnPdf.disabled = true;

        const doc = await criarDocumentoPdf(dados);
        doc.save(`FluxoPagamento - ${dados.nomeCliente.replace(/ /g, '_') || 'proposta'} - ${dados.dataProposta}.pdf`);

        btnPdf.textContent = 'Download PDF';
        btnPdf.disabled = false;
    }

    async function salvarPdfNoNegocio() {
        const dados = obterDadosCalculados();
        if (!validarCampos(dados, true)) return; // true para checar o ID do neg√≥cio

        const btnSalvar = document.getElementById('btn-salvar-negocio');
        btnSalvar.textContent = 'A Gerar e Enviar...';
        btnSalvar.disabled = true;

        const doc = await criarDocumentoPdf(dados);
        const dealId = document.getElementById('bitrixDealId').value;
        const linkWebhook = "https://midrah.bitrix24.com.br/rest/8425/64q171jcgecefxfa/"; 
        const CampoId = "UF_CRM_1755806050";
        const nomeArquivo = `FluxoPagamento - ${dados.nomeCliente.replace(/ /g, '_') || 'proposta'} - ${dados.dataProposta}.pdf`;
        const pdfBase64 = doc.output('datauristring').substring(doc.output('datauristring').indexOf(',') + 1);
        
        const params = new URLSearchParams();
        params.append('ID', dealId);
        params.append(`FIELDS[${CampoId}][fileData][0]`, nomeArquivo);
        params.append(`FIELDS[${CampoId}][fileData][1]`, pdfBase64);
        
        try {
            const response = await fetch(linkWebhook + 'crm.deal.update', { method: 'POST', body: params });
            const result = await response.json();
            if (result.error) { throw new Error(result.error_description); }
            mostrarNotificacao(`PDF enviado com sucesso para o neg√≥cio ID: ${dealId}!`, 'success');
        } catch (error) {
            console.error("Erro no envio para o Bitrix:", error);
            mostrarNotificacao(`Erro ao enviar: ${error.message}`, 'error');
        } finally {
            btnSalvar.textContent = 'Salvar PDF no Neg√≥cio';
            btnSalvar.disabled = false;
        }
    }

/**
 * Formata os dados como texto otimizado para WhatsApp (COM ESPA√áAMENTO FOR√áADO) e copia.
 */
function copiarTextoProposta() {
    const dados = obterDadosCalculados();
    if (dados.totalGeral === 0) {
        return mostrarNotificacao("Calcule um fluxo antes de copiar.", 'error');
    }

    /**
     * Fun√ß√£o auxiliar fi√°vel para formatar datas como "ago/25".
     * @param {Date} data - O objeto de data a ser formatado.
     * @returns {string} A data formatada.
     */
    function formatarDataMesAno(data) {
        const meses = ["jan", "fev", "mar", "abr", "mai", "jun", "jul", "ago", "set", "out", "nov", "dez"];
        const mes = meses[data.getMonth()];
        const ano = data.getFullYear().toString().slice(-2);
        return `${mes}/${ano}`;
    }

    const dataFormatada = dados.dataProposta ? new Date(dados.dataProposta + 'T00:00:00').toLocaleDateString('pt-BR') : '';

    let textoParaCopiar = `Nome Empreendimento: ${dados.nomeEmpreendimento}\n`;
    textoParaCopiar += `Tipo Unidade: ${dados.tipoUnidade}\n`;
    textoParaCopiar += `√Årea Privativa (m¬≤): ${dados.areaPrivativa}\n`;
    textoParaCopiar += `Nome do Cliente: ${dados.nomeCliente || ''}\n`;
    textoParaCopiar += `Data da Proposta: ${dataFormatada}\n\n`;

    textoParaCopiar += "üìç *Fluxo:*\n";

    const dataInicial = new Date(dados.dataProposta + 'T00:00:00');
    let dataCorrente = new Date(dataInicial);

    let totalInvestido = 0;
    let valorFinanciado = 0;
    const contadores = {};
    const emojis = {
        'Ato': 'üí∞', 'Sinal': 'üí∞', 'Mensais': 'üìÖ',
        'Anual': 'üìÖ', 'Unica': 'üîë', 'Financiamento': 'üîÑ'
    };

    dados.parcelas.forEach(p => {
        if (p.nome.toLowerCase() === 'financiamento') {
            valorFinanciado = p.subtotal;
            return;
        }

        totalInvestido += p.subtotal;
        
        const emoji = emojis[p.nome] || '‚û°Ô∏è';
        let infoData = '';
        
        contadores[p.nome] = (contadores[p.nome] || 0) + 1;
        let nomeExibicao = p.nome;
        if (p.qtde > 1 && contadores[p.nome] > 1 || (p.nome.toLowerCase() === 'anual')) {
             nomeExibicao = `${contadores[p.nome]}¬™ ${p.nome}`;
        }

        const dataInicio = new Date(dataCorrente);
        let valorExibido;

        if (p.qtde > 1) {
            let dataFim = new Date(dataCorrente);
            dataFim.setMonth(dataFim.getMonth() + p.qtde - 1);
            
            // üëá LINHA CORRIGIDA com o "espa√ßo inquebr√°vel" (\u00A0) üëá
            infoData = `(${formatarDataMesAno(dataInicio)}\u00A0a\u00A0${formatarDataMesAno(dataFim)}\u00A0‚Äì\u00A0${p.qtde}x)`;
            // NOTA: \u00A0 √© o c√≥digo para um "espa√ßo n√£o separ√°vel".

            valorExibido = p.valorParcela;
        } else {
            infoData = `(${formatarDataMesAno(dataInicio)})`;
            valorExibido = p.subtotal;
        }

        const valorFormatado = valorExibido.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });
        textoParaCopiar += `${emoji} ${nomeExibicao} ${infoData}: ${valorFormatado}\n`;

        dataCorrente.setMonth(dataCorrente.getMonth() + p.qtde);
    });

    textoParaCopiar += `\nüíµ *Total investido:* ${totalInvestido.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' })}\n`;
    if (valorFinanciado > 0) {
        textoParaCopiar += `üîÑ *Financiado:* ${valorFinanciado.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' })}\n`;
    }
    textoParaCopiar += `üí∞ *TOTAL GERAL:* ${dados.valorTotal.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' })}`;

    navigator.clipboard.writeText(textoParaCopiar).then(() => {
        mostrarNotificacao('Texto para WhatsApp copiado!', 'success');
    }).catch(err => {
        console.error('Erro ao copiar texto:', err);
        mostrarNotificacao('N√£o foi poss√≠vel copiar o texto.', 'error');
    });
}


    function init() {
        document.getElementById('dataProposta').value = new Date().toISOString().split('T')[0];
        document.getElementById('btn-calcular')?.addEventListener('click', renderizarResultados);
        document.getElementById('btn-gerar-pdf')?.addEventListener('click', apenasFazerDownload);
        document.getElementById('btn-copiar-texto')?.addEventListener('click', copiarTextoProposta);
        document.getElementById('btn-salvar-negocio')?.addEventListener('click', salvarPdfNoNegocio);
        
        document.getElementById('simulador-pagamento').addEventListener('input', (event) => {
            if (event.target.matches('.perc-input, .qnt-input, #valorTotal')) {
                atualizarTotalPerc();
            }
        });
        atualizarTotalPerc();
    }

    document.addEventListener('DOMContentLoaded', init);
</script>

</body>
</html>