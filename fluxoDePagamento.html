<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Fluxo_pagamento</title>
    <style>
        #simulador-pagamento { max-width: 800px; margin: auto; font-family: Arial, sans-serif; }
        .titulo-principal { text-align: center; background: rgb(9, 9, 9); color: white; padding: 10px; border-radius: 5px; }
        .bloco-entradas { background: #f4f4f4; padding: 15px; border-radius: 5px; }
        .tabela-entradas td { padding: 4px; }
        .tabela-entradas input[type="text"], .tabela-entradas input[type="number"] { width: 100%; box-sizing: border-box; }
        .tabela-entradas input.qnt-input { width: 60px; }
        #totalPerc.invalido { color: red; font-weight: bold; }
        #totalPerc.valido { color: green; font-weight: bold; }
        .botao-principal { margin-top: 10px; padding: 10px; background: steelblue; color: white; border: none; border-radius: 5px; cursor: pointer; width: 100%; font-size: 16px; }
        .botao-principal:hover { background: #3a7299; }
        .botao-principal:disabled { background-color: #cccccc; cursor: not-allowed; }
        .tabela-resultado { border-collapse: collapse; text-align: center; width: 100%; }
        .tabela-resultado th, .tabela-resultado td { border: 1px solid #ddd; padding: 8px; }
        .tabela-resultado thead { background: steelblue; color: white; }
        .tabela-resultado tfoot tr { background: lightgreen; font-weight: bold; }
    </style>
</head>
<body>
    <div id="simulador-pagamento">
        <h2 class="titulo-principal">FLUXO DE PAGAMENTO</h2>

        <div class="bloco-entradas">
            <table class="tabela-entradas">
                <tr><td>Nome Empreendimento:</td><td><input type="text" id="nomeEmpreendimento"></td></tr>
                <tr><td>Tipo Unidade:</td><td><input type="text" id="tipoUnidade"></td></tr>
                <tr><td>Área Privativa (m²):</td><td><input type="text" id="areaPrivativa"></td></tr>
            </table>
            <hr style="margin: 15px 0;">
            <label>Valor do Imóvel (R$):</label>
            <input type="number" id="valorTotal" placeholder="Digite o valor total" style="width: 100%; padding: 5px; margin-bottom: 10px;">
            <table class="tabela-entradas">
                <tr><th>Etapa</th><th>Parcelas</th><th>%</th></tr>
                <tr class="linha-etapa" data-etapa="Ato"><td>Ato</td><td><input type="number" class="qnt-input"></td><td><input type="number" class="perc-input"></td></tr>
                <tr class="linha-etapa" data-etapa="Sinal"><td>Sinal</td><td><input type="number" class="qnt-input"></td><td><input type="number" class="perc-input"></td></tr>
                <tr class="linha-etapa" data-etapa="Mensais"><td>Mensais</td><td><input type="number" class="qnt-input"></td><td><input type="number" class="perc-input"></td></tr>
                <tr class="linha-etapa" data-etapa="Anual"><td>Anual</td><td><input type="number" class="qnt-input"></td><td><input type="number" class="perc-input"></td></tr>
                <tr class="linha-etapa" data-etapa="Unica"><td>Única</td><td><input type="number" class="qnt-input"></td><td><input type="number" class="perc-input"></td></tr>
                <tr class="linha-etapa" data-etapa="Fin"><td>Financiamento</td><td><input type="number" class="qnt-input"></td><td><input type="number" class="perc-input"></td></tr>
                <tr><td><strong>Total %</strong></td><td></td><td><span id="totalPerc">0.00%</span></td></tr>
            </table>
            <button id="btn-calcular" class="botao-principal">Calcular</button>
        </div>

        <h3 style="margin-top: 20px;">Resultado:</h3>
        <div id="resumo-empreendimento" style="padding: 10px; background: #e9e9e9; border-radius: 5px; margin-bottom: 15px; display: none;"></div>
        <table class="tabela-resultado">
            <thead>
                <tr><th>PARCELAS</th><th>QTDE</th><th>VALOR PARCELA</th><th>SUBTOTAL</th></tr>
            </thead>
            <tbody id="resultado"></tbody>
            <tfoot>
                <tr><td colspan="3">Total</td><td id="totalValor">R$ 0,00</td></tr>
            </tfoot>
        </table>
    </div>

    <script>
        const btnCalcular = document.getElementById('btn-calcular');
        const spanTotalPerc = document.getElementById('totalPerc');
        const inputValorTotal = document.getElementById('valorTotal');
        const linhasEtapa = document.querySelectorAll('.linha-etapa');
        const resultadoBody = document.getElementById('resultado');
        const totalValorFooter = document.getElementById('totalValor');

        function atualizarTotalPerc() {
            let totalPerc = 0;
            document.querySelectorAll('.perc-input').forEach(input => {
                totalPerc += parseFloat(input.value) || 0;
            });
            spanTotalPerc.innerText = totalPerc.toFixed(2) + "%";
            const isTotal100 = totalPerc.toFixed(2) === '100.00';
            spanTotalPerc.className = isTotal100 ? 'valido' : 'invalido';
            btnCalcular.disabled = !isTotal100;
        }

        function calcularFluxo() {
            const nomeEmp = document.getElementById('nomeEmpreendimento').value;
            const tipoUni = document.getElementById('tipoUnidade').value;
            const areaPri = document.getElementById('areaPrivativa').value;
            const resumoContainer = document.getElementById('resumo-empreendimento');
            const valorTotal = parseFloat(inputValorTotal.value) || 0;

            const areaPrivativaNumerica = parseFloat(areaPri) || 0;
            let precoM2Texto = 'Não aplicável';
            if (valorTotal > 0 && areaPrivativaNumerica > 0) {
                const precoM2 = valorTotal / areaPrivativaNumerica;
                precoM2Texto = precoM2.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });
            }

            if (nomeEmp || tipoUni || areaPri) {
                resumoContainer.innerHTML = `
                    <p style="margin: 2px 0;"><strong>Empreendimento:</strong> ${nomeEmp || 'Não informado'}</p>
                    <p style="margin: 2px 0;"><strong>Unidade:</strong> ${tipoUni || 'Não informado'}</p>
                    <p style="margin: 2px 0;"><strong>Área Privativa:</strong> ${areaPri ? areaPri + ' m²' : 'Não informado'}</p>
                    <p style="margin: 2px 0;"><strong>Preço por m²:</strong> ${precoM2Texto}</p>
                `;
                resumoContainer.style.display = 'block';
            } else {
                resumoContainer.style.display = 'none';
            }
            
            let corpoTabelaHTML = "";
            let totalGeralCalculado = 0;
            linhasEtapa.forEach(linha => {
                const nomeEtapa = linha.dataset.etapa;
                const perc = parseFloat(linha.querySelector('.perc-input').value) || 0;
                const qtde = parseInt(linha.querySelector('.qnt-input').value) || 0;
                if (perc > 0) {
                    const subtotal = (perc / 100) * valorTotal;
                    const valorParcela = qtde > 0 ? subtotal / qtde : subtotal;
                    totalGeralCalculado += subtotal;
                    corpoTabelaHTML += `<tr>
                        <td>${nomeEtapa}</td>
                        <td>${qtde || 1}</td>
                        <td>R$ ${valorParcela.toLocaleString('pt-BR', {minimumFractionDigits: 2})}</td>
                        <td>R$ ${subtotal.toLocaleString('pt-BR', {minimumFractionDigits: 2})}</td>
                    </tr>`;
                }
            });
            resultadoBody.innerHTML = corpoTabelaHTML;
            totalValorFooter.innerHTML = "<strong>" + totalGeralCalculado.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' }) + "</strong>";
        }

        document.addEventListener('DOMContentLoaded', () => {
            btnCalcular.addEventListener('click', calcularFluxo);
            document.querySelectorAll('.perc-input, .qnt-input, #valorTotal, #areaPrivativa').forEach(input => {
                input.addEventListener('input', atualizarTotalPerc);
            });
            atualizarTotalPerc();
        });
    </script>
</body>
</html>